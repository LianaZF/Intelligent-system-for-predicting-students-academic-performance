<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Мониторинг успеваемости студентов</title>
  <style>
    :root {
      --green: #4caf50; --yellow: #ff9800; --red: #f44336; --gray: #9e9e9e;
      --bg: #f8fafc; --card: #ffffff; --primary: #2196f3;
    }
    body { font-family: 'Segoe UI', Arial, sans-serif; margin:0; background: var(--bg); color: #2d3748; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    header { background: #2196f3; color: white; padding: 20px; border-radius: 12px; margin-bottom: 30px; text-align: center; box-shadow: 0 4px 15px rgba(33,150,243,0.3); }
    h1 { margin:0; font-size: 2em; }
    .subtitle { opacity: 0.9; font-weight: normal; }

    /* Карточки студентов */
    .students-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 24px; }
    .student-card {
      background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      transition: all 0.3s; cursor: pointer;
    }
    .student-card:hover { transform: translateY(-8px); box-shadow: 0 12px 30px rgba(0,0,0,0.15); }
    .student-header {
      padding: 20px; display: flex; align-items: center; justify-content: space-between;
      border-bottom: 1px solid #eee;
    }
    .student-name { font-size: 1.3em; font-weight: 600; margin: 0; }
    .risk-indicator {
      width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
      font-size: 20px; color: white;
    }
    .risk-green { background: var(--green); }
    .risk-yellow { background: var(--yellow); }
    .risk-red { background: var(--red); }

    .student-details { padding: 0 20px 20px; max-height: 0; overflow: hidden; transition: all 0.4s ease; }
    .student-details.open { max-height: 800px; padding-top: 20px; }

    .metrics { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px; }
    .metric {
      background: #f8f9fa; padding: 14px; border-radius: 12px; text-align: center;
    }
    .metric-label { font-size: 0.9em; color: #718096; margin-bottom: 6px; }
    .metric-value { font-size: 1.4em; font-weight: bold; color: #2d3748; }

    .forecast { margin-top: 20px; padding: 16px; background: #e3f2fd; border-radius: 12px; text-align: center; }
    .forecast strong { color: #1976d2; font-size: 1.5em; }

    .actions { margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap; }
    .btn {
      padding: 10px 16px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.2s;
    }
    .btn-primary { background: #2196f3; color: white; }
    .btn-success { background: #4caf50; color: white; }
    .btn-sm { padding: 6px 12px; font-size: 0.9em; }

    .support-measures { margin-top: 16px; }
    .measure-item {
      display: flex; align-items: center; gap: 10px; padding: 8px 0; border-bottom: 1px dashed #ddd;
    }
    .measure-item input[type="checkbox"] { transform: scale(1.3); }

    .top-bar {
      display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;
      flex-wrap: wrap; gap: 15px;
    }
    .report-btn {
      background: #8e44ad; color: white; padding: 14px 28px; font-size: 1.1em; border-radius: 12px;
    }

    /* Админ-панель */
    .admin-section { background: white; padding: 30px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-top: 30px; }
    .admin-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }

    .hidden { display: none !important; }
    .close-btn { position: absolute; top: 15px; right: 20px; font-size: 32px; cursor: pointer; color: #aaa; }
    .close-btn:hover { color: #f44336; }

    .notification {
      position: fixed; top: 20px; right: 20px; padding: 16px 24px; border-radius: 12px; color: white;
      font-weight: bold; z-index: 1000; transform: translateX(400px); transition: transform 0.4s;
    }
    .notification.show { transform: translateX(0); }
    .success { background: #4caf50; }
    .error { background: #f44336; }
  </style>
</head>
<body>

<div class="container" id="app">

  <!-- Экран выбора роли -->
  <div id="role-screen">
    <header style="margin: 100px auto; max-width: 600px;">
      <h1>Мониторинг успеваемости студентов</h1>
      <p class="subtitle">Выберите роль для входа в систему</p>
    </header>
    <div style="display: flex; justify-content: center; gap: 40px; flex-wrap: wrap;">
      <div class="card role-teacher" style="padding:40px; text-align:center; width:280px;" onclick="loginAs('teacher')">
        <h2>Преподаватель</h2>
        <p>Просмотр аналитики по группам и студентам</p>
      </div>
      <div class="card role-admin" style="padding:40px; text-align:center; width:280px;" onclick="loginAs('admin')">
        <h2>Администратор</h2>
        <p>Управление пользователями и моделью</p>
      </div>
    </div>
  </div>

  <!-- Дашборд преподавателя -->
  <div id="teacher-dashboard" class="hidden">
    <div class="close-btn" onclick="logout()">×</div>
    <header>
      <h1>Группа ИТ-21 | Дисциплина: Программирование на Python</h1>
      <p class="subtitle">Преподаватель: Иванов Иван Иванович</p>
    </header>

    <div class="top-bar">
      <div>
        <h2>Студенты группы</h2>
        <p>Всего: 24 студента | В зоне риска: <strong style="color:var(--red)">4</strong> | Под риском: <strong style="color:var(--yellow)">7</strong></p>
      </div>
      <button class="report-btn btn" onclick="generateFullReport()">Сводный отчёт по группе</button>
    </div>

    <div class="students-grid" id="students-grid">
      <!-- Карточки студентов будут здесь -->
    </div>
  </div>

  <!-- Админ-панель -->
  <div id="admin-dashboard" class="hidden">
    <div class="close-btn" onclick="logout()">×</div>
    <header>
      <h1>Панель администратора</h1>
    </header>

    <div class="admin-grid">
      <div class="admin-section">
        <h2>Управление пользователями</h2>
        <button class="btn btn-primary" onclick="alert('Форма добавления пользователя (будет в следующей версии)')">Добавить пользователя</button>
        <p style="margin-top:20px;">Всего пользователей: <strong>48</strong> (32 преподавателя, 16 администраторов)</p>
      </div>

      <div class="admin-section">
        <h2>Модель машинного обучения</h2>
        <p>Текущая точность: <strong>88.1%</strong></p>
        <p>Последнее обучение: <strong>28 ноября 2025</strong></p>
        <p>Количество записей в датасете: <strong>12 450</strong></p>
        <button class="btn btn-success" style="margin-top:15px; padding:14px 28px; font-size:1.1em;" onclick="retrainModel()">
          Переобучить модель
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// Данные студентов
const students = [
  { name: "Александров Дмитрий Сергеевич", risk: "green", avgPrev: 4.6, lmsHours: 48, selfStudy: 12, attendance: 96, forecast: 87 },
  { name: "Борисова Анна Михайловна", risk: "yellow", avgPrev: 3.9, lmsHours: 32, selfStudy: 8, attendance: 88, forecast: 72 },
  { name: "Васильев Никита Александрович", risk: "red", avgPrev: 3.1, lmsHours: 18, selfStudy: 4, attendance: 71, forecast: 54 },
  { name: "Григорьева Елена Петровна", risk: "green", avgPrev: 4.8, lmsHours: 56, selfStudy: 15, attendance: 98, forecast: 91 },
  { name: "Дмитриев Сергей Владимирович", risk: "yellow", avgPrev: 3.7, lmsHours: 28, selfStudy: 7, attendance: 84, forecast: 68 },
  { name: "Егорова Мария Алексеевна", risk: "red", avgPrev: 2.9, lmsHours: 14, selfStudy: 3, attendance: 65, forecast: 48 },
];

function loginAs(role) {
  document.getElementById('role-screen').classList.add('hidden');
  if (role === 'teacher') {
    renderTeacherDashboard();
    document.getElementById('teacher-dashboard').classList.remove('hidden');
  } else {
    document.getElementById('admin-dashboard').classList.remove('hidden');
  }
}

function renderTeacherDashboard() {
  const grid = document.getElementById('students-grid');
  grid.innerHTML = '';

  students.forEach((s, i) => {
    const card = document.createElement('div');
    card.className = 'student-card';
    card.innerHTML = `
      <div class="student-header">
        <h3 class="student-name">${s.name}</h3>
        <div class="risk-indicator risk-${s.risk}"></div>
      </div>
      <div class="student-details">
        <div class="metrics">
          <div class="metric">
            <div class="metric-label">Средний балл (прошлые сессии)</div>
            <div class="metric-value">${s.avgPrev.toFixed(1)}</div>
          </div>
          <div class="metric">
            <div class="metric-label">Часы в LMS</div>
            <div class="metric-value">${s.lmsHours}</div>
          </div>
          <div class="metric">
            <div class="metric-label">Самостоятельная подготовка, ч/нед</div>
            <div class="metric-value">${s.selfStudy}</div>
          </div>
          <div class="metric">
            <div class="metric-label">Посещаемость</div>
            <div class="metric-value">${s.attendance}%</div>
          </div>
        </div>

        <div class="forecast">
          Прогноз итогового балла: <strong>${s.forecast}</strong> из 100
        </div>

        <div class="support-measures">
          <h4>Принятые меры поддержки:</h4>
          <div class="measure-item">
            <input type="checkbox" id="m1-${i}"><label for="m1-${i}">Дополнительные консультации</label>
          </div>
          <div class="measure-item">
            <input type="checkbox" id="m2-${i}"><label for="m2-${i}">Индивидуальный план</label>
          </div>
          <div class="measure-item">
            <input type="checkbox" id="m3-${i}"><label for="m3-${i}">Работа с тьютором</label>
          </div>
        </div>

        <div class="actions">
          <button class="btn btn-primary btn-sm" onclick="alert('Открыта подробная карточка студента')">Подробно</button>
          <button class="btn btn-success btn-sm" onclick="showNotif('Меры сохранены')">Сохранить меры</button>
        </div>
      </div>
    `;

    // Раскрытие карточки по клику
    card.querySelector('.student-header').onclick = (e) => {
      e.stopPropagation();
      card.querySelector('.student-details').classList.toggle('open');
    };

    grid.appendChild(card);
  });
}

function generateFullReport() {
  const csv = [
    ["ФИО", "Риск", "Средний балл (прошлый)", "LMS, ч", "Самост., ч/нед", "Посещаемость", "Прогноз"],
    ...students.map(s => [
      s.name,
      s.risk === 'green' ? 'Низкий' : s.risk === 'yellow' ? 'Средний' : 'Высокий',
      s.avgPrev, s.lmsHours, s.selfStudy, s.attendance, s.forecast
    ])
  ].map(row => row.join(";")).join("\n");

  const blob = new Blob(["\ufeff" + csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `Отчет_ИТ-21_${new Date().toISOString().slice(0,10)}.csv`;
  a.click();
  URL.revokeObjectURL(url);

  showNotif('Сводный отчёт успешно сформирован и скачан', 'success');
}

function retrainModel() {
  if (!confirm('Запустить переобучение модели? Это займёт несколько минут.')) return;

  const notif = showNotif('Переобучение модели запущено...', 'success');
  setTimeout(() => {
    notif.textContent = 'Модель успешно переобучена! Точность: 88.1%';
    setTimeout(() => notif.remove(), 5000);
  }, 4000);
}

function showNotif(text, type = 'success') {
  const n = document.createElement('div');
  n.className = `notification ${type}`;
  n.textContent = text;
  document.body.appendChild(n);
  setTimeout(() => n.classList.add('show'), 100);
  setTimeout(() => {
    n.classList.remove('show');
    setTimeout(() => n.remove(), 500);
  }, 5000);
  return n;
}

function logout() {
  document.querySelectorAll('#teacher-dashboard, #admin-dashboard').forEach(el => el.classList.add('hidden'));
  document.getElementById('role-screen').classList.remove('hidden');
}
</script>

</body>
</html>